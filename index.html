<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProGlove Bowl Tracking System</title>
    
    <!-- Link to external styles.css -->
    <link rel="stylesheet" href="styles.css">

    <!-- Firebase SDKs for Realtime Database -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
</head>
<body class="app-body">

    <!-- Fixed container for messages -->
    <div id="messageContainer" class="message-container"></div>

    <div class="container mx-auto space-y-6 max-w-4xl">
        
        <!-- Header -->
        <header class="app-header">
            <h1 class="header-title">üß§ PROGLOVE BOWL TRACKING</h1>
            <p class="text-gray-400 mt-1">Real-time Prep & Return Synchronization</p>
        </header>

        <!-- Mode Selection (Step 1) -->
        <section class="app-card" id="modeSelectionCard">
            <h2 class="section-title">1. Select Operation Mode</h2>
            <div class="flex-row-group">
                <button id="kitchenBtn" onclick="setMode('kitchen')" class="mode-button bg-gray-600 transition duration-150 hover:bg-emerald-600">üç≥ KITCHEN PREP</button>
                <button id="returnBtn" onclick="setMode('return')" class="mode-button bg-gray-600 transition duration-150 hover:bg-red-600">üîÑ RETURN SCAN</button>
            </div>
            <div id="modeDisplay" class="status-box bg-gray-500 mt-4">Status: Please Select Mode</div>
        </section>

        <!-- User & Dish Selection (Step 2) -->
        <section class="app-card opacity-50 transition duration-300" id="userSelectionCard">
            <h2 class="section-title">2. Select User & Dish</h2>
            
            <div class="flex-row-group">
                <div class="flex-1">
                    <label for="userSelect" class="input-label">User Name</label>
                    <select id="userSelect" onchange="selectUser(this.value)" class="app-select" disabled>
                        <option value="" disabled selected>-- Select User --</option>
                    </select>
                </div>

                <div class="flex-1 hidden" id="dishSection">
                    <label for="dishLetterSelect" class="input-label">Dish Letter (A-Z / 1-4)</label>
                    <select id="dishLetterSelect" onchange="selectDishLetter(this.value)" class="app-select" disabled>
                        <option value="" disabled selected>-- Select Dish --</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- Scanning Controls (Step 3) -->
        <section class="app-card opacity-50 transition duration-300" id="scanningCard">
            <h2 class="section-title">3. Scanner Input</h2>
            
            <div class="flex-row-group">
                <button id="startBtn" onclick="startScanning()" class="mode-button accent-green hover:bg-emerald-700 transition duration-150" disabled>‚ñ∂ START SCANNER</button>
                <button id="stopBtn" onclick="stopScanning()" class="mode-button accent-red hover:bg-red-700 transition duration-150" disabled>‚èπ STOP SCANNER</button>
            </div>
            
            <div class="relative mt-4">
                <input type="text" id="scanInput" placeholder="Select User and Press START..." class="scanner-input" disabled autocomplete="off">
            </div>

            <!-- Metrics Panel -->
            <div class="metrics-grid">
                <div class="text-center">
                    <p class="text-xs text-gray-400">User Scans (<span id="myDishLetterLabel">---</span>)</p>
                    <p id="myScansCount" class="accent-text-green metric-value">0</p>
                </div>
                <div class="text-center">
                    <p class="text-xs text-gray-400">Prepared Today</p>
                    <p id="preparedTodayCount" class="accent-text-pink metric-value">0</p>
                </div>
                <div class="text-center">
                    <p class="text-xs text-gray-400">Active (Out)</p>
                    <p id="activeCount" class="text-red-400 metric-value">0</p>
                </div>
                <div class="text-center">
                    <p class="text-xs text-gray-400">Returned Today</p>
                    <p id="exportReturnCount" class="text-indigo-400 metric-value">0</p>
                </div>
            </div>
        </section>
        
        <!-- Live Statistics Table -->
        <section class="app-card">
            <h2 class="section-title">Live Prep Report (10 PM Cycle)</h2>
            <div class="overflow-x-auto bg-gray-900 rounded-lg">
                <table class="data-table">
                    <thead>
                        <tr class="accent-text-pink bg-gray-700">
                            <th class="px-3 py-2 text-left font-semibold">Dish</th>
                            <th class="px-3 py-2 text-left font-semibold">User</th>
                            <th class="px-3 py-2 text-left font-semibold">Count</th>
                        </tr>
                    </thead>
                    <tbody id="livePrepReportBody">
                        <tr><td colspan="3" class="px-3 py-2 text-center text-gray-400">No kitchen scans recorded during this cycle.</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Data Management -->
        <section class="app-card data-management-section">
            <h2 class="section-title">Data Management & Export</h2>
            
            <p id="lastSyncInfo" class="text-xs text-gray-500">Awaiting sync...</p>

            <div class="grid-col-2-group">
                <button onclick="exportActiveBowls()" class="mode-button bg-blue-600 hover:bg-blue-700 text-sm">üì• Export Active Bowls</button>
                <button onclick="exportReturnData()" class="mode-button bg-purple-600 hover:bg-purple-700 text-sm">üì• Export Returns</button>
                <button onclick="exportAllData()" class="col-span-2 mode-button bg-indigo-600 hover:bg-indigo-700 text-sm">üìä Export ALL Data</button>
            </div>

            <div class="border-t border-gray-700 pt-4 space-y-3">
                <h3 class="text-gray-300 font-semibold">JSON Import (Customer Data Patch)</h3>
                <textarea id="jsonData" placeholder='Paste JSON data here (e.g., [{"vytUrl": "URL_HERE", "company": "Company", "customer": "Name", "dishLetter": "A"}]). NOTE: vytUrl is mandatory for activation.' class="app-textarea"></textarea>
                <div class="flex-row-group">
                    <button onclick="processJSONData(document.getElementById('jsonData').value)" class="mode-button bg-yellow-600 hover:bg-yellow-700 text-sm">üîÑ Patch Customer Data</button>
                    <button onclick="resetTodaysPreparedBowls()" class="mode-button bg-red-800 hover:bg-red-900 text-sm">üóëÔ∏è Reset Prepared/Scans</button>
                </div>
            </div>
        </section>

    </div>

    <!-- Script links -->
    <script src="code.js"></script> 
</body>
</html>
