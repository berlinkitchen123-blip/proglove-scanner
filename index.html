<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProGlove Bowl Tracking System</title>
    
    <!-- REMOVE THESE - Let JavaScript load Firebase dynamically -->
    <!-- <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script> -->
    <!-- <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script> -->
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        /* ... (keep all your existing CSS styles) ... */
        
        /* Add Firebase Status Styles */
        .firebase-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
            display: inline-block;
        }
        .firebase-status.connected {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .firebase-status.connecting {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .firebase-status.disconnected {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .firebase-status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .firebase-status.unknown {
            background-color: #e2e3e5;
            color: #383d41;
            border: 1px solid #d6d8db;
        }
    </style>
</head>
<body class="app-body">

    <!-- Fixed container for messages -->
    <div id="messageBox" class="message-container"></div>

    <div class="container app-spacing">
        
        <!-- Header -->
        <header class="app-header header-shadow">
            <h1 class="header-title">üß§ PROGLOVE BOWL TRACKING</h1>
            <p class="header-subtitle">Real-time Prep & Return Synchronization</p>
            <div style="margin-top: 10px;">
                <span id="systemStatus" class="status-box">Loading...</span>
                <span id="firebaseStatus" class="firebase-status unknown">‚ö™ Firebase Unknown</span>
            </div>
        </header>

        <!-- Mode Selection (Step 1) -->
        <section class="app-card" id="modeSelectionCard">
            <h2 class="section-title">1. Select Operation Mode</h2>
            <div class="flex-row-group">
                <button id="kitchenBtn" class="mode-button btn-neutral hover-green">üç≥ KITCHEN PREP</button>
                <button id="returnBtn" class="mode-button btn-neutral hover-red">üîÑ RETURN SCAN</button>
            </div>
            <div id="modeDisplay" class="status-box status-neutral mt-4">Status: Please Select Mode</div>
        </section>

        <!-- User & Dish Selection (Step 2) -->
        <section class="app-card opacity-50 transition-slow" id="userSelectionCard">
            <h2 class="section-title">2. Select User & Dish</h2>
            
            <div class="flex-row-group">
                <div class="flex-1">
                    <label class="input-label">User Name</label>
                    <select id="userDropdown" class="app-select" disabled>
                        <option value="">-- Select Mode First --</option>
                    </select>
                </div>

                <!-- Dish Selection Section -->
                <div class="flex-1 hidden" id="dishSection"> 
                    <label class="input-label">Dish Letter (A-Z / 1-4)</label>
                    <select id="dishDropdown" class="app-select" disabled>
                        <option value="">-- Dish Letter --</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- Scanning Controls (Step 3) -->
        <section class="app-card opacity-50 transition-slow" id="scanningCard">
            <h2 class="section-title">3. Scanner Input</h2>
            
            <div class="flex-row-group">
                <button id="startBtn" class="mode-button btn-pill accent-green btn-action-glow" disabled>‚ñ∂ START SCANNER</button>
                <button id="stopBtn" class="mode-button btn-pill accent-red" disabled>‚èπ STOP SCANNER</button>
            </div>
            
            <div class="relative mt-4">
                <input type="text" id="progloveInput" placeholder="Select User and Press START..." class="scanner-input input-glow" disabled autocomplete="off">
            </div>

            <!-- Metrics Panel -->
            <div class="metrics-grid">
                <div class="metric-item card-subtle">
                    <p class="metric-label">User Scans (<span id="myDishLetterLabel">---</span>)</p>
                    <p id="myScansCount" class="metric-value text-accent-green">0</p>
                </div>
                <div class="metric-item card-subtle">
                    <p class="metric-label">Prepared Today</p>
                    <p id="prepCount" class="metric-value text-accent-pink">0</p>
                </div>
                <div class="metric-item card-subtle">
                    <p class="metric-label">Active (Out)</p>
                    <p id="activeCount" class="metric-value text-accent-red">0</p>
                </div>
                <div class="metric-item card-subtle">
                    <p class="metric-label">Returned Today</p>
                    <p id="returnCount" class="metric-value text-accent-indigo">0</p>
                </div>
            </div>
        </section>
        
        <!-- Live Statistics Table -->
        <section class="app-card">
            <h2 class="section-title">Live Stats</h2>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr class="table-header-row">
                            <th class="table-header-cell">Dish</th>
                            <th class="table-header-cell">User</th>
                            <th class="table-header-cell">Count</th>
                            <th class="table-header-cell">First Scan</th>
                            <th class="table-header-cell">Last Scan</th>
                        </tr>
                    </thead>
                    <tbody id="overnightStatsBody">
                        <tr><td colspan="5" class="table-empty-cell">No scans recorded</td></tr>
                    </tbody>
                </table>
            </div>
            <div id="cycleInfo" class="text-accent-green mt-2" style="font-size: 0.875rem;"></div>
        </section>
        
        <!-- Data Management -->
        <section class="app-card">
            <h2 class="section-title">Data Management & Export</h2>
            
            <p id="exportInfo" class="sync-status-text">Loading data...</p>

            <div class="grid-col-2-group">
                <button id="exportActiveBtn" class="mode-button bg-blue-600 text-sm hover-blue">üì• Export Active Bowls</button>
                <button id="exportReturnBtn" class="mode-button bg-purple-600 text-sm hover-purple">üì• Export Returns</button>
                <button id="exportAllBtn" class="mode-button bg-indigo-600 text-sm hover-indigo">üìä Export ALL Data</button>
                <button id="checkFirebaseBtn" class="mode-button bg-yellow-600 text-sm hover-yellow">üîç Check Firebase</button>
                <button id="syncFirebaseBtn" class="mode-button bg-green-600 text-sm hover-green">üîÑ Sync to Cloud</button>
                <button id="loadFirebaseBtn" class="mode-button bg-gray-600 text-sm hover-gray">üì• Load from Cloud</button>
            </div>

            <div class="border-t pt-4 space-y-3 border-gray-700">
                <h3 class="input-label text-gray-300 font-semibold">JSON Import (Customer Data Patch)</h3>
                <textarea id="jsonData" placeholder='Paste JSON data here...' class="app-textarea"></textarea>
                <div class="flex-row-group">
                    <button id="processJsonBtn" class="mode-button bg-yellow-600 text-sm hover-yellow">üîÑ Process JSON Data</button>
                </div>
                <div id="patchResults" style="display: none; background: var(--color-bg-light-card); padding: 10px; border-radius: 5px; margin-top: 10px;">
                    <strong id="patchSummary">Processing results will appear here</strong>
                </div>
            </div>
        </section>

    </div>

    <!-- Script links -->
    <script src="code.js"></script>
</body>
</html>
