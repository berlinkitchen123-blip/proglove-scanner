<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProGlove Bowl Tracker</title>
    <!-- Load Tailwind CSS (via CDN for simplicity, acknowledging the production warning) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Load Firebase SDKs FIRST (CRITICAL: Load App and Database before code.js runs) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <style>
        /* Dark Theme Styles */
        body { font-family: 'Inter', sans-serif; background-color: #0d1117; color: #c9d1d9; }
        .card { background-color: #161b22; border: 1px solid #30363d; }
        .scan-input { font-family: monospace; }
        .scanning-active { box-shadow: 0 0 10px rgba(52, 168, 83, 0.9), 0 0 20px rgba(52, 168, 83, 0.5); }
        .data-table th { background-color: #30363d; color: #f0f6fc; }
        .data-table td { border-color: #30363d; }
        .data-table tr:hover { background-color: #21262d; }
    </style>
</head>
<body>
    <div class="max-w-4xl mx-auto p-4 md:p-8">
        <div class="text-center mb-6">
            <h1 class="text-3xl font-bold text-pink-400">ü•£ ProGlove Bowl Tracker</h1>
            <p class="text-sm text-gray-400">Real-time Inventory & Statistics System</p>
        </div>

        <!-- System Message Container -->
        <div id="messageContainer" class="fixed top-0 left-1/2 -translate-x-1/2 w-full max-w-sm z-50 p-2"></div>

        <!-- Mode & Status -->
        <div class="card p-4 rounded-xl shadow-lg mb-6">
            <h2 class="text-xl font-semibold mb-3 text-gray-300">System Status</h2>
            <div id="modeDisplay" class="text-center font-bold p-3 rounded-lg bg-gray-500 text-white transition-colors duration-300">
                Status: System Initializing...
            </div>
            <p id="lastSyncInfo" class="text-xs text-right mt-2 text-gray-500">
                üíæ Last Sync: N/A
            </p>
        </div>

        <!-- STEP 1: SELECT MODE -->
        <div class="card p-4 rounded-xl shadow-lg mb-6">
            <h2 class="text-xl font-semibold mb-3 text-pink-400">Step 1: Select Operation Mode</h2>
            <div class="flex space-x-4">
                <button id="kitchenBtn" onclick="setMode('kitchen')" class="flex-1 p-3 rounded-lg font-bold text-white bg-gray-600 hover:bg-emerald-700 transition duration-150">
                    üç≥ KITCHEN PREP
                </button>
                <button id="returnBtn" onclick="setMode('return')" class="flex-1 p-3 rounded-lg font-bold text-white bg-gray-600 hover:bg-red-700 transition duration-150">
                    üîÑ RETURN SCAN
                </button>
            </div>
        </div>

        <!-- STEP 2 & 3: USER & DISH SELECTION -->
        <div id="userSelectionCard" class="card p-4 rounded-xl shadow-lg mb-6 transition-opacity duration-300 opacity-50">
            <h2 class="text-xl font-semibold mb-3 text-pink-400">Step 2: Select User</h2>
            <select id="userSelect" onchange="selectUser(this.value)" class="w-full p-3 rounded-lg bg-[#30363d] text-white border border-gray-600 focus:ring-pink-500 focus:border-pink-500" disabled>
                <option value="" disabled selected>-- Select User --</option>
            </select>

            <div id="dishSection" class="mt-4 hidden">
                <h2 class="text-xl font-semibold mb-3 text-pink-400">Step 3: Select Dish Letter</h2>
                <select id="dishLetterSelect" onchange="selectDishLetter(this.value)" class="w-full p-3 rounded-lg bg-[#30363d] text-white border border-gray-600 focus:ring-pink-500 focus:border-pink-500" disabled>
                    <option value="" disabled selected>-- Select Dish Letter --</option>
                </select>
            </div>
        </div>

        <!-- STEP 4: SCANNING CONTROLS -->
        <div id="scanningCard" class="card p-4 rounded-xl shadow-lg mb-6 transition-opacity duration-300 opacity-50">
            <h2 class="text-xl font-semibold mb-3 text-pink-400">Step 4: Scanning Controls</h2>
            <div class="flex space-x-4 mb-3">
                <button id="startBtn" onclick="startScanning()" class="flex-1 p-3 rounded-lg font-bold text-white bg-emerald-600 hover:bg-emerald-500 transition duration-150" disabled>
                    ‚ñ∂ ACTIVATE SCANNER
                </button>
                <button id="stopBtn" onclick="stopScanning()" class="flex-1 p-3 rounded-lg font-bold text-white bg-red-600 hover:bg-red-500 transition duration-150" disabled>
                    ‚èπ DEACTIVATE
                </button>
            </div>

            <div class="relative mb-4">
                <input type="text" id="scanInput" placeholder="Scanner Input (Code appears here)..." class="scan-input w-full p-4 text-center text-xl font-mono rounded-lg bg-[#30363d] text-yellow-300 border-2 border-gray-600 focus:border-pink-500 focus:ring-pink-500 transition-all duration-300" disabled>
                <span id="scanStatus" class="absolute top-2 right-2 text-xs font-semibold px-2 py-1 rounded-full bg-gray-500 text-white">Stopped</span>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-center text-sm font-semibold">
                <div class="p-2 rounded-lg bg-gray-700">User: <span id="selectedUser" class="text-pink-400">---</span></div>
                <div class="p-2 rounded-lg bg-gray-700">Dish: <span id="selectedDishLetter" class="text-pink-400">---</span></div>
                <div class="p-2 rounded-lg bg-gray-700">My Scans: <span id="myScansCount" class="text-emerald-400 font-bold">0</span></div>
                <div class="p-2 rounded-lg bg-gray-700">Prepared: <span id="preparedTodayCount" class="text-yellow-400 font-bold">0</span></div>
            </div>
        </div>

        <!-- LIVE PREP REPORT -->
        <div class="card p-4 rounded-xl shadow-lg mb-6">
            <h2 class="text-xl font-semibold mb-3 text-pink-400">Live Prep Report (10PM Cycle)</h2>
            <div class="overflow-x-auto rounded-lg border border-gray-600">
                <table class="data-table w-full text-left">
                    <thead>
                        <tr>
                            <th class="px-3 py-2 text-center w-1/5">Dish</th>
                            <th class="px-3 py-2 w-3/5">User / Count</th>
                            <th class="px-3 py-2 text-center w-1/5">Total</th>
                        </tr>
                    </thead>
                    <tbody id="livePrepReportBody" class="text-sm">
                        <tr><td colspan="3" class="px-3 py-2 text-center text-gray-400">Loading data...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- DATA MANAGEMENT & EXPORT -->
        <div class="card p-4 rounded-xl shadow-lg mb-6 border-pink-500 border-2">
            <h2 class="text-xl font-semibold mb-3 text-pink-400">Data Management</h2>

            <div class="grid grid-cols-2 gap-3 text-sm text-center mb-4">
                <div class="p-2 rounded-lg bg-gray-700">Active: <span id="exportActiveCount" class="text-pink-400 font-bold">0</span></div>
                <div class="p-2 rounded-lg bg-gray-700">Prepared: <span id="exportPreparedCount" class="text-yellow-400 font-bold">0</span></div>
                <div class="p-2 rounded-lg bg-gray-700 col-span-2">Returns Today: <span id="exportReturnCount" class="text-red-400 font-bold">0</span></div>
            </div>

            <div class="space-y-3">
                <button onclick="exportAllData()" class="w-full p-3 rounded-lg font-bold text-white bg-blue-600 hover:bg-blue-500 transition duration-150">
                    üíæ EXPORT ALL DATA (JSON)
                </button>
                <button onclick="resetTodaysPreparedBowls()" class="w-full p-3 rounded-lg font-bold text-white bg-orange-600 hover:bg-orange-500 transition duration-150">
                    üóëÔ∏è RESET PREPARED INVENTORY & SCANS
                </button>
            </div>
        </div>

        <!-- JSON INPUT FOR CUSTOMER DATA -->
        <div class="card p-4 rounded-xl shadow-lg">
            <h2 class="text-xl font-semibold mb-3 text-pink-400">Import Customer Data (JSON)</h2>
            <textarea id="jsonData" placeholder='Paste JSON array here to convert Prepared bowls to Active bowls. Format: [{ "vytUrl": "...", "company": "...", "customer": "..." }]' rows="5" class="w-full p-3 rounded-lg bg-[#30363d] text-sm text-gray-300 border border-gray-600 resize-none focus:ring-pink-500 focus:border-pink-500"></textarea>
            <button onclick="processJSONData(document.getElementById('jsonData').value)" class="w-full mt-3 p-3 rounded-lg font-bold text-white bg-purple-600 hover:bg-purple-500 transition duration-150">
                üîÑ APPLY CUSTOMER DATA & ACTIVATE BOWLS
            </button>
        </div>
    </div>
    
    <!-- LINK TO LOGIC FILE (MUST BE LAST SCRIPT IN BODY) -->
    <script src="code.js"></script>
</body>
</html>
