<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProGlove Bowl Tracking System</title>
    
    <!-- Link to external styles.css -->
    <link rel="stylesheet" href="styles.css">

    <!-- Firebase SDKs for Realtime Database -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
</head>
<body class="app-body">

    <!-- Fixed container for messages -->
    <div id="messageContainer" class="message-container"></div>

    <div class="container app-spacing">
        
        <!-- Header -->
        <header class="app-header">
            <h1 class="header-title">üß§ PROGLOVE BOWL TRACKING</h1>
            <p class="header-subtitle">Real-time Prep & Return Synchronization</p>
        </header>

        <!-- Mode Selection (Step 1) -->
        <section class="app-card" id="modeSelectionCard">
            <h2 class="section-title">1. Select Operation Mode</h2>
            <div class="flex-row-group">
                <button id="kitchenBtn" onclick="setMode('kitchen')" class="mode-button btn-neutral hover-green">üç≥ KITCHEN PREP</button>
                <button id="returnBtn" onclick="setMode('return')" class="mode-button btn-neutral hover-red">üîÑ RETURN SCAN</button>
            </div>
            <div id="modeDisplay" class="status-box status-neutral mt-4">Status: Please Select Mode</div>
        </section>

        <!-- User & Dish Selection (Step 2) -->
        <section class="app-card opacity-half transition-slow" id="userSelectionCard">
            <h2 class="section-title">2. Select User & Dish</h2>
            
            <div class="flex-row-group">
                <div class="flex-1">
                    <label for="userSelect" class="input-label">User Name</label>
                    <select id="userSelect" onchange="selectUser(this.value)" class="app-select" disabled>
                        <option value="" disabled selected>-- Select User --</option>
                    </select>
                </div>

                <div class="flex-1 hidden" id="dishSection">
                    <label for="dishLetterSelect" class="input-label">Dish Letter (A-Z / 1-4)</label>
                    <select id="dishLetterSelect" onchange="selectDishLetter(this.value)" class="app-select" disabled>
                        <option value="" disabled selected>-- Select Dish --</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- Scanning Controls (Step 3) -->
        <section class="app-card opacity-half transition-slow" id="scanningCard">
            <h2 class="section-title">3. Scanner Input</h2>
            
            <div class="flex-row-group">
                <button id="startBtn" onclick="startScanning()" class="mode-button btn-primary accent-green" disabled>‚ñ∂ START SCANNER</button>
                <button id="stopBtn" onclick="stopScanning()" class="mode-button btn-secondary accent-red" disabled>‚èπ STOP SCANNER</button>
            </div>
            
            <div class="relative mt-4">
                <input type="text" id="scanInput" placeholder="Select User and Press START..." class="scanner-input" disabled autocomplete="off">
            </div>

            <!-- Metrics Panel -->
            <div class="metrics-grid">
                <div class="metric-item">
                    <p class="metric-label">User Scans (<span id="myDishLetterLabel">---</span>)</p>
                    <p id="myScansCount" class="metric-value text-accent-green">0</p>
                </div>
                <div class="metric-item">
                    <p class="metric-label">Prepared Today</p>
                    <p id="preparedTodayCount" class="metric-value text-accent-pink">0</p>
                </div>
                <div class="metric-item">
                    <p class="metric-label">Active (Out)</p>
                    <p id="activeCount" class="metric-value text-accent-red">0</p>
                </div>
                <div class="metric-item">
                    <p class="metric-label">Returned Today</p>
                    <p id="exportReturnCount" class="metric-value text-accent-indigo">0</p>
                </div>
            </div>
        </section>
        
        <!-- Live Statistics Table -->
        <section class="app-card">
            <h2 class="section-title">Live Prep Report (10 PM Cycle)</h2>
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr class="table-header-row">
                            <th class="table-header-cell">Dish</th>
                            <th class="table-header-cell">User</th>
                            <th class="table-header-cell">Count</th>
                        </tr>
                    </thead>
                    <tbody id="livePrepReportBody">
                        <tr><td colspan="3" class="table-empty-cell">No kitchen scans recorded during this cycle.</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Data Management -->
        <section class="app-card data-management-section">
            <h2 class="section-title">Data Management & Export</h2>
            
            <p id="lastSyncInfo" class="sync-status-text">Awaiting sync...</p>

            <div class="grid-col-2-group">
                <button onclick="exportActiveBowls()" class="mode-button bg-blue-600 text-sm">üì• Export Active Bowls</button>
                <button onclick="exportReturnData()" class="mode-button bg-purple-600 text-sm">üì• Export Returns</button>
                <button onclick="exportAllData()" class="col-span-2 mode-button bg-indigo-600 text-sm">üìä Export ALL Data</button>
            </div>

            <div class="border-t border-gray-700 pt-4 space-y-3">
                <h3 class="input-label text-gray-300 font-semibold">JSON Import (Customer Data Patch)</h3>
                <textarea id="jsonData" placeholder='Paste JSON data here (e.g., [{"vytUrl": "URL_HERE", "company": "Company", "customer": "Name", "dishLetter": "A"}]). NOTE: vytUrl is mandatory for activation.' class="app-textarea"></textarea>
                <div class="flex-row-group">
                    <button onclick="processJSONData(document.getElementById('jsonData').value)" class="mode-button bg-yellow-600 text-sm">üîÑ Patch Customer Data</button>
                    <button onclick="resetTodaysPreparedBowls()" class="mode-button bg-red-800 text-sm">üóëÔ∏è Reset Prepared/Scans</button>
                </div>
            </div>
        </section>

    </div>

    <!-- Script links -->
    <script src="code.js"></script> 
</body>
</html>
