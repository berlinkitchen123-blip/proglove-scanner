<!DOCTYPE html>
<html lang="en">
<head>
<!--
    *** CRITICAL FIX: UTF-8 ENCODING ***
    This meta tag ensures all special characters (like currency symbols, non-Latin text, or complex characters)
    are correctly displayed in the browser, fixing the common character error.
-->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ProGlove Scanner - Complete System</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: Arial, sans-serif; background: #1a1a1a; color: white; padding: 10px; }
.container { max-width: 100%; margin: 0 auto; display: flex; flex-direction: column; gap: 15px; }
.header { background: #4285f4; padding: 15px; text-align: center; border-radius: 10px; }
.card { background: #2a2a2a; padding: 15px; border-radius: 10px; margin-bottom: 10px; }
.sync-controls { display: flex; gap: 10px; margin-bottom: 10px; }
.sync-btn { flex: 1; padding: 12px; border: none; border-radius: 6px; font-size: 14px; font-weight: bold; cursor: pointer; }
.download-btn { background: #4285f4; color: white; }
.upload-btn { background: #34a853; color: white; }
.export-btn { background: #f57c00; color: white; }
.backup-btn { background: #ea4335; color: white; }
.sync-btn:disabled { background: #666; cursor: not-allowed; }
.system-status { padding: 10px; margin-top: 10px; border-radius: 5px; text-align: center; font-size: 12px; background: #444; border-left: 4px solid #f57c00; }
.mode-buttons { display: flex; gap: 10px; margin-bottom: 15px; }
.mode-btn { flex: 1; padding: 15px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; }
.kitchen-btn { background: #34a853; color: white; }
.return-btn { background: #ea4335; color: white; }
.mode-btn.active { box-shadow: 0 0 0 3px white; }
.dropdown { width: 100%; padding: 12px; background: #444; color: white; border: 2px solid #666; border-radius: 6px; font-size: 16px; margin-top: 10px; }
.scan-controls { display: flex; gap: 10px; margin-bottom: 15px; }
.scan-btn { flex: 1; padding: 15px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; }
.start-btn { background: #34a853; color: white; }
.stop-btn { background: #ea4335; color: white; }
.scan-btn:disabled { background: #666; cursor: not-allowed; }
.proglove-input { width: 100%; padding: 15px; font-size: 18px; background: #333; color: white; border: 2px solid #666; border-radius: 8px; margin-bottom: 15px; text-align: center; }
.proglove-input.error { border-color: #ea4335; animation: shake 0.5s; }
.scanning-active { animation: pulse 1.5s infinite; border: 3px solid #34a853; }
.feedback { padding: 12px; margin-top: 10px; border-radius: 6px; text-align: center; font-weight: bold; min-height: 50px; display: flex; align-items: center; justify-content: center; }
.success { background: #34a853; }
.error { background: #ea4335; }
.warning { background: #f57c00; }
.info { background: #4285f4; }
.hidden { display: none; }
.stats-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
.stat-item { background: #333; padding: 15px; border-radius: 8px; text-align: center; }
.stat-value { font-size: 24px; font-weight: bold; }
.kitchen-stat { color: #34a853; }
.return-stat { color: #ea4335; }
.active-stat { color: #4285f4; }
.prep-stat { color: #f57c00; }
.response-time { font-size: 12px; color: #888; text-align: center; margin-top: 5px; }
.local-data { background: #2a2a2a; padding: 10px; border-radius: 5px; margin-top: 10px; font-size: 12px; border-left: 4px solid #f57c00; }
.upload-info { background: #2a2a2a; padding: 10px; border-radius: 5px; margin-top: 10px; font-size: 12px; border-left: 4px solid #4285f4; }
.cross-team-data { background: #2a2a2a; padding: 10px; border-radius: 5px; margin-top: 10px; font-size: 12px; border-left: 4px solid #f57c00; }
.data-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
.data-label { font-weight: bold; }
.admin-section { border: 2px solid #f57c00; }
.backup-status { background: #2a2a2a; padding: 8px; border-radius: 5px; margin-top: 5px; font-size: 11px; border-left: 4px solid #34a853; }

/* Table Styles */
.data-table { 
width: 100%; 
border-collapse: collapse; 
margin-top: 10px;
font-size: 11px;
}
.data-table th {
background: #4285f4;
color: white;
padding: 6px;
text-align: center;
border: 1px solid #555;
}
.data-table td {
padding: 6px;
text-align: center;
border: 1px solid #555;
background: #333;
}
.dish-header { background: #34a853; font-weight: bold; }

/* JSON Upload */
.json-upload { background: #333; padding: 10px; border-radius: 5px; margin: 10px 0; }
.json-textarea { width: 100%; height: 120px; background: #444; color: white; border: 1px solid #666; border-radius: 5px; padding: 8px; font-family: monospace; font-size: 12px; }

@keyframes pulse { 
0% { box-shadow: 0 0 0 0 rgba(52, 168, 83, 0.7); } 
70% { box-shadow: 0 0 0 15px rgba(52, 168, 83, 0); } 
100% { box-shadow: 0 0 0 0 rgba(52, 168, 83, 0); } 
}
@keyframes shake { 
0%, 100% { transform: translateX(0); } 
25% { transform: translateX(-5px); } 
75% { transform: translateX(5px); } 
}
</style>
</head>
<body>
<div class="container">
<div class="header">
<h1>üß§ ProGlove Scanner - Complete System</h1>
<p>Real-time Tracking ‚Ä¢ Data Export ‚Ä¢ Daily Reset</p>
</div>

<!-- Message Container (For showMessage in code.js) -->
<div id="messageContainer" class="fixed top-0 right-0 p-4 z-50 flex flex-col items-end">
    <!-- Messages will be prepended here by showMessage() function in code.js -->
</div>

<div class="card">
<h3>üìä SYSTEM STATUS</h3>

<!-- ADDED: Connection Status (Updated instantly by code.js) -->
<div class="system-status" id="connectionStatus" style="background: #444; border-left: 4px solid #f57c00; color: white;">
    Loading Connection Status...
</div>

<!-- EXISTING: Mode Status (Uses modeDisplay ID from code.js logic) -->
<div class="system-status mt-2" id="modeDisplay">
    Kitchen Prep Mode
</div>

<!-- EXISTING: Scanner Status -->
<div class="backup-status" id="scanStatus">
    Scanner OFF
</div>
</div>

<div class="card">
<h3>üì± SELECT MODE</h3>
<div class="mode-buttons">
<button class="mode-btn kitchen-btn" onclick="setMode('kitchen')" id="kitchenBtn">üç≥ KITCHEN</button>
<button class="mode-btn return-btn" onclick="setMode('return')" id="returnBtn">üîÑ RETURN</button>
</div>
</div>

<div class="card">
<h3>üë§ SELECT USER</h3>
<!-- DROPDOWN POPULATED BY JS -->
<select class="dropdown" id="userSelect">
<option value="">-- Select User --</option>
</select>
<div class="local-data mt-2">
    Selected User: <strong id="selectedUser"></strong>
</div>
</div>

<div class="card" id="dishSection">
<h3>üìù SELECT DISH LETTER</h3>
<!-- DROPDOWN POPULATED BY JS -->
<select class="dropdown" id="dishLetterSelect">
<option value="">-- Select Dish Letter --</option>
</select>
<div class="local-data mt-2">
    Selected Dish: <strong id="selectedDishLetter"></strong>
</div>
</div>

<!-- SCANNING SECTION -->
<div class="card" id="scanSection">
<h3>üîç SCANNING CONTROLS</h3>
<div class="scan-controls">
<button class="scan-btn start-btn" id="startBtn" onclick="startScanning()">‚ñ∂ START SCANNING</button>
<button class="scan-btn stop-btn" id="stopBtn" onclick="stopScanning()" disabled>‚èπ STOP SCANNING</button>
</div>

<!-- SCAN INPUT - ProGlove sends data here -->
<input type="text" class="proglove-input" id="scanInput" placeholder="Click 'START SCANNING' to begin..." disabled>

<div class="response-time">
<span id="responseTimeValue" class="hidden">0</span>
</div>

<div class="stats-grid">
<div class="stat-item">
<div class="stat-label">Active Bowls</div>
<div class="stat-value active-stat" id="activeCount">0</div>
</div>
<div class="stat-item">
<div class="stat-label" id="preparedTodayLabel">Prepared Today</div>
<div class="stat-value prep-stat" id="preparedTodayCount">0</div>
</div>
<div class="stat-item">
<div class="stat-label">My Scans (<span id="myDishLetterLabel">A</span>)</div>
<div class="stat-value kitchen-stat" id="myScansCount">0</div>
</div>
</div>

<!-- Feedback Message Container (code.js handles this via showMessage) -->
<div id="feedback" class="hidden">
    <!-- Feedback will be displayed here if messageContainer is not used -->
</div>
</div>

<!-- LIVE PREP REPORT TABLE -->
<div class="card">
<h3>üìà LIVE PREP REPORT</h3>
<div class="local-data">
<strong>Reporting Window:</strong> <span id="reportingWindowInfo">10 PM (Yesterday) - 10 PM (Today)</span>
</div>
<div id="livePrepReport">
<table class="data-table">
<thead>
<tr>
<th>Dish</th>
<th>User</th>
<th>Total</th>
</tr>
</thead>
<tbody id="livePrepReportBody">
<tr><td colspan="3" style="text-align: center;">No kitchen preparation scans recorded during the current reporting window.</td></tr>
</tbody>
</table>
</div>
</div>

<!-- DATA EXPORT SECTION -->
<div class="card admin-section">
<h3>üì§ DATA EXPORT</h3>
<div class="sync-controls">
<button class="sync-btn export-btn" onclick="exportActiveBowls()" id="exportActiveBtn">
üì• EXPORT ACTIVE BOWLS
</button>
<button class="sync-btn export-btn" onclick="exportReturnData()" id="exportReturnBtn">
üì• EXPORT RETURN DATA
</button>
<button class="sync-btn export-btn" onclick="exportAllData()" id="exportAllBtn">
üìä EXPORT ALL DATA
</button>
</div>
<div class="local-data" id="exportInfo">
<div class="data-row">
    <span class="data-label">Active Bowls:</span> <span id="activeExportCount">0</span>
</div>
<div class="data-row">
    <span class="data-label">Prepared Bowls:</span> <span id="preparedExportCount">0</span>
</div>
<div class="data-row">
    <span class="data-label">Returned Today:</span> <span id="returnedTodayExportCount">0</span>
</div>
</div>
</div>

<!-- JSON DATA PASTE SECTION -->
<div class="card">
    <h3>üìÅ PASTE CUSTOMER DATA (JSON)</h3>
    <div class="json-upload">
        <textarea class="json-textarea" id="jsonData" placeholder='Paste JSON data here (Example):
[
 {
   "vytUrl": "https://vyt.co/VYT12345",
   "company": "Company Name",
   "customer": "Customer Name",
   "dish": "A"
 }
]

Make sure VYT URLs match exactly with scanned bowl codes!'></textarea>
        <div class="sync-controls">
            <button class="sync-btn upload-btn" onclick="processJSONData(document.getElementById('jsonData').value)">üîÑ PATCH CUSTOMER DATA</button>
            <button class="sync-btn backup-btn" onclick="document.getElementById('jsonData').value=''">üóëÔ∏è CLEAR</button>
        </div>
        
        <!-- RESET BUTTON -->
        <div class="sync-controls" style="margin-top: 10px;">
            <button onclick="resetTodaysPreparedBowls(); updateDisplay();" class="sync-btn" style="background: #f57c00; color: white;">
                üîÑ RESET TODAY'S PREPARED BOWLS
            </button>
        </div>
    </div>
    <div class="local-data" id="jsonStatus">
        <strong>JSON Status:</strong> No data loaded
    </div>
    <div class="local-data" id="patchResults" style="display: none;">
        <strong>Patch Results:</strong> <span id="patchSummary">Waiting for patch...</span>
        <div id="failedMatches" style="margin-top: 5px;"></div>
    </div>
</div>

<!-- Main Application Logic (Code is kept in external JS file: code.js) -->
<script src="code.js"></script>
</body>
</html>

