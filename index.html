
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProGlove Bowl Tracking System</title>
    <!-- Link to external styles.css -->
    <link rel="stylesheet" href="styles.css">

    <!-- Firebase SDKs for Realtime Database -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    
    <!-- Final CSS to ensure all required dark theme styles are available -->
    <style>
        /* This internal block defines necessary global styles, overriding Tailwind assumptions */
        .app-body {
            background-color: #1f2937; /* Dark Gray Background */
            color: #f3f4f6; /* Light text color */
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            padding: 1.5rem;
        }
        .app-card {
            background-color: #374151; /* Slightly lighter card background */
            border: 1px solid #4b5563; /* Subtle border */
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        .app-header {
            background-color: #374151;
            padding: 1.5rem;
            border-bottom: 4px solid #db2777; /* border-pink-700 */
            border-radius: 0.75rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .header-title {
            color: #f472b6; /* text-pink-400 */
            font-weight: 800;
            font-size: 1.875rem; /* text-3xl */
        }
        .accent-green {
            background-color: #059669; /* bg-emerald-600 */
            color: white;
        }
        .accent-red {
            background-color: #dc2626; /* bg-red-600 */
            color: white;
        }
        .accent-text-green {
            color: #34d399; /* text-emerald-400 */
        }
        .accent-text-pink {
            color: #f472b6; /* text-pink-400 */
        }
        /* Further specific styles can be added to the external styles.css */
    </style>
</head>
<body class="app-body">

    <!-- Fixed container for messages -->
    <div id="messageContainer" class="fixed top-0 left-0 right-0 z-50 p-4 max-w-sm mx-auto pointer-events-none"></div>

    <div class="container mx-auto max-w-4xl space-y-6">
        
        <!-- Header -->
        <header class="app-header">
            <h1 class="header-title">üß§ PROGLOVE BOWL TRACKING</h1>
            <p class="text-gray-400 mt-1">Real-time Prep & Return Synchronization</p>
        </header>

        <!-- Mode Selection (Step 1) -->
        <section class="app-card" id="modeSelectionCard">
            <h2 class="text-gray-200 font-semibold text-xl border-b border-gray-700 pb-2">1. Select Operation Mode</h2>
            <div class="flex flex-col md:flex-row gap-4 mt-4">
                <button id="kitchenBtn" onclick="setMode('kitchen')" class="flex-1 p-3 rounded-lg text-white font-bold bg-gray-600 transition duration-150 hover:bg-emerald-600">üç≥ KITCHEN PREP</button>
                <button id="returnBtn" onclick="setMode('return')" class="flex-1 p-3 rounded-lg text-white font-bold bg-gray-600 transition duration-150 hover:bg-red-600">üîÑ RETURN SCAN</button>
            </div>
            <div id="modeDisplay" class="text-center p-2 rounded bg-gray-500 text-sm font-semibold mt-4">Status: Please Select Mode</div>
        </section>

        <!-- User & Dish Selection (Step 2) -->
        <section class="app-card opacity-50 transition duration-300" id="userSelectionCard">
            <h2 class="text-gray-200 font-semibold text-xl border-b border-gray-700 pb-2">2. Select User & Dish</h2>
            
            <div class="flex flex-col md:flex-row gap-4 mt-4">
                <div class="flex-1">
                    <label for="userSelect" class="block text-gray-400 mb-1">User Name</label>
                    <select id="userSelect" onchange="selectUser(this.value)" class="w-full bg-gray-700 text-gray-200 p-2 rounded border border-gray-600" disabled>
                        <option value="" disabled selected>-- Select User --</option>
                    </select>
                </div>

                <div class="flex-1 hidden" id="dishSection">
                    <label for="dishLetterSelect" class="block text-gray-400 mb-1">Dish Letter (A-Z / 1-4)</label>
                    <select id="dishLetterSelect" onchange="selectDishLetter(this.value)" class="w-full bg-gray-700 text-gray-200 p-2 rounded border border-gray-600" disabled>
                        <option value="" disabled selected>-- Select Dish --</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- Scanning Controls (Step 3) -->
        <section class="app-card opacity-50 transition duration-300" id="scanningCard">
            <h2 class="text-gray-200 font-semibold text-xl border-b border-gray-700 pb-2">3. Scanner Input</h2>
            
            <div class="flex gap-4 mt-4">
                <button id="startBtn" onclick="startScanning()" class="flex-1 p-3 rounded-lg text-white font-bold accent-green hover:bg-emerald-700 transition duration-150" disabled>‚ñ∂ START SCANNER</button>
                <button id="stopBtn" onclick="stopScanning()" class="flex-1 p-3 rounded-lg text-white font-bold accent-red hover:bg-red-700 transition duration-150" disabled>‚èπ STOP SCANNER</button>
            </div>
            
            <div class="relative mt-4">
                <input type="text" id="scanInput" placeholder="Select User and Press START..." class="w-full text-lg accent-text-pink bg-gray-900 border-4 border-gray-600 focus:border-pink-600 rounded-lg p-3 text-center transition duration-200" disabled autocomplete="off">
            </div>

            <!-- Metrics Panel -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 pt-2 border-t border-gray-700 mt-4">
                <div class="text-center">
                    <p class="text-xs text-gray-400">User Scans (<span id="myDishLetterLabel">---</span>)</p>
                    <p id="myScansCount" class="accent-text-green font-extrabold text-2xl">0</p>
                </div>
                <div class="text-center">
                    <p class="text-xs text-gray-400">Prepared Today</p>
                    <p id="preparedTodayCount" class="accent-text-pink font-extrabold text-2xl">0</p>
                </div>
                <div class="text-center">
                    <p class="text-xs text-gray-400">Active (Out)</p>
                    <p id="activeCount" class="text-red-400 font-extrabold text-2xl">0</p>
                </div>
                <div class="text-center">
                    <p class="text-xs text-gray-400">Returned Today</p>
                    <p id="exportReturnCount" class="text-indigo-400 font-extrabold text-2xl">0</p>
                </div>
            </div>
        </section>
        
        <!-- Live Statistics Table -->
        <section class="app-card">
            <h2 class="text-gray-200 font-semibold text-xl border-b border-gray-700 pb-2 mb-3">Live Prep Report (10 PM Cycle)</h2>
            <div class="overflow-x-auto bg-gray-900 rounded-lg">
                <table class="min-w-full text-sm">
                    <thead>
                        <tr class="accent-text-pink bg-gray-700">
                            <th class="px-3 py-2 text-left font-semibold">Dish</th>
                            <th class="px-3 py-2 text-left font-semibold">Count</th>
                            <th class="px-3 py-2 text-left font-semibold">Users</th>
                        </tr>
                    </thead>
                    <tbody id="livePrepReportBody">
                        <tr><td colspan="3" class="px-3 py-2 text-center text-gray-400">No kitchen scans recorded during this cycle.</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Data Management -->
        <section class="app-card space-y-4">
            <h2 class="text-gray-200 font-semibold text-xl border-b border-gray-700 pb-2">Data Management & Export</h2>
            
            <p id="lastSyncInfo" class="text-xs text-gray-500">Awaiting sync...</p>

            <div class="grid grid-cols-2 gap-3">
                <button onclick="exportActiveBowls()" class="p-3 rounded-lg text-white font-bold bg-blue-600 hover:bg-blue-700 transition duration-150 text-sm">üì• Export Active Bowls</button>
                <button onclick="exportReturnData()" class="p-3 rounded-lg text-white font-bold bg-purple-600 hover:bg-purple-700 transition duration-150 text-sm">üì• Export Returns</button>
                <button onclick="exportAllData()" class="col-span-2 p-3 rounded-lg text-white font-bold bg-indigo-600 hover:bg-indigo-700 transition duration-150 text-sm">üìä Export ALL Data</button>
            </div>

            <div class="border-t border-gray-700 pt-4 space-y-3">
                <h3 class="text-gray-300 font-semibold">JSON Import (Customer Data Patch)</h3>
                <textarea id="jsonData" placeholder='Paste JSON data here (e.g., [{"vytUrl": "URL_HERE", "company": "Company", "customer": "Name", "dishLetter": "A"}]). NOTE: vytUrl is mandatory for activation.' class="w-full h-32 bg-gray-900 text-gray-200 p-3 rounded border border-gray-700 text-sm"></textarea>
                <div class="flex gap-3">
                    <button onclick="processJSONData(document.getElementById('jsonData').value)" class="flex-1 p-3 rounded-lg text-white font-bold bg-yellow-600 hover:bg-yellow-700 transition duration-150 text-sm">üîÑ Patch Customer Data</button>
                    <button onclick="resetTodaysPreparedBowls()" class="flex-1 p-3 rounded-lg text-white font-bold bg-red-800 hover:bg-red-900 transition duration-150 text-sm">üóëÔ∏è Reset Prepared/Scans</button>
                </div>
            </div>
        </section>

    </div>

    <!-- Script links -->
    <script src="code.js"></script> 
</body>
</html>
